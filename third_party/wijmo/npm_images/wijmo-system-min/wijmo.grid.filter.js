/*
    *
    * Wijmo Library 5.20171.282
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the Wijmo Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */
System.register(['wijmo/wijmo.grid','wijmo/wijmo','wijmo/wijmo.input','wijmo/wijmo.grid.filter'],function(n,t){"use strict";var b=t&&t.id,l=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},f,i,e,p,o,a,s,v,h,r,c,y,u,w;return{setters:[function(n){f=n},function(n){i=n},function(n){e=n},function(n){p=n}],execute:function(){window.wijmo=window.wijmo||{};window.wijmo.grid=window.wijmo.grid||{};window.wijmo.grid.filter=p;o=function(){function n(n){this._maxValues=250;this._sortValues=!0;this._col=n;this._bnd=n.binding?new i.Binding(n.binding):null}return Object.defineProperty(n.prototype,"showValues",{get:function(){return this._values},set:function(n){this._values=n},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"filterText",{get:function(){return this._filterText},set:function(n){this._filterText=i.asString(n)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"maxValues",{get:function(){return this._maxValues},set:function(n){this._maxValues=i.asNumber(n,!1,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"uniqueValues",{get:function(){return this._uniqueValues},set:function(n){this._uniqueValues=i.asArray(n)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"sortValues",{get:function(){return this._sortValues},set:function(n){this._sortValues=i.asBoolean(n)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"dataMap",{get:function(){return this._map},set:function(n){this._map=i.asType(n,f.DataMap,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"column",{get:function(){return this._col},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isActive",{get:function(){return this._values!=null&&Object.keys(this._values).length>0},enumerable:!0,configurable:!0}),n.prototype.apply=function(n){var t=this.column;return!this._bnd||!this._values||!Object.keys(this._values).length?!0:(n=this._bnd.getValue(n),n=this.dataMap?this.dataMap.getDisplayValue(n):t.dataMap?t.dataMap.getDisplayValue(n):i.Globalize.format(n,t.format),this._values[n]!=undefined)},n.prototype.clear=function(){this.showValues=null;this.filterText=null},n.prototype.implementsInterface=function(n){return n=='IColumnFilter'},n}();n("ValueFilter",o);a=function(n){function t(t,r){var u,f,s;n.call(this,t);this._filter=i.asType(r,o,!1);u=this.getTemplate();this.applyTemplate('wj-control',u,{_divFilter:'div-filter',_cbSelectAll:'cb-select-all',_spSelectAll:'sp-select-all',_divValues:'div-values'});this._spSelectAll.textContent=i.culture.FlexGridFilter.selectAll;this._view=new i.CollectionView;r.sortValues&&(f=r.column.dataMap||r.dataMap?'text':'value',s=r.column.dataType!=i.DataType.Boolean,this._view.sortDescriptions.push(new i.SortDescription(f,s)));this._view.filter=this._filterValues.bind(this);this._view.collectionChanged.addHandler(this._updateSelectAllCheck,this);this._filterText='';this._cmbFilter=new e.ComboBox(this._divFilter,{placeholder:i.culture.FlexGridFilter.search});this._lbValues=new e.ListBox(this._divValues,{displayMemberPath:'text',checkedMemberPath:'show',itemsSource:this._view,itemFormatter:function(n,t){return t?t:i.culture.FlexGridFilter.null}});this._cmbFilter.textChanged.addHandler(this._filterTextChanged,this);this._cbSelectAll.addEventListener('click',this._cbSelectAllClicked.bind(this));this.updateEditor()}return l(t,n),Object.defineProperty(t.prototype,"filter",{get:function(){return this._filter},enumerable:!0,configurable:!0}),t.prototype.updateEditor=function(){var n=this;setTimeout(function(){n._updateEditor()})},t.prototype._updateEditor=function(){var r=this._filter.column,t=[],h,a,c,u,o,s,v,n;if(this._lbValues.isContentHtml=r.isContentHtml,this._view.pageSize=this._filter.maxValues,this._view.sourceCollection=t,this._filter.uniqueValues)for(h=this._filter.uniqueValues,n=0;n<h.length;n++)u=h[n],t.push({value:u,text:u.toString()});else{var l={},f=r.collectionView?r.collectionView.sourceCollection:[],e=r.collectionView;if(e&&e.sourceCollection&&e.filter){for(a=this._filter.showValues,this._filter.showValues=null,c=[],n=0;n<f.length;n++)e.filter(f[n])&&c.push(f[n]);f=c;this._filter.showValues=a}for(n=0;n<f.length;n++)u=r._binding.getValue(f[n]),o=this._filter.dataMap?this._filter.dataMap.getDisplayValue(u):r.dataMap?r.dataMap.getDisplayValue(u):i.Globalize.format(u,r.format),l[o]||(l[o]=!0,t.push({value:u,text:o}),t.length>5&&this._view.items.length==0&&(this._view.refresh(),this._lbValues.refresh()))}if(s=this._filter.showValues,s&&Object.keys(s).length!=0){for(v in s)for(n=0;n<t.length;n++)if(t[n].text==v){t[n].show=!0;break}}else for(n=0;n<t.length;n++)t[n].show=!0;this._cmbFilter.text=this._filter.filterText;this._filterText=this._cmbFilter.text.toLowerCase();this._view.refresh();this._view.moveCurrentToPosition(-1)},t.prototype.clearEditor=function(){var t,n;for(this._cmbFilter.text='',this._filterText='',this._view.refresh(),t=this._view.items,n=0;n<t.length;n++)t[n].show=!1},t.prototype.updateFilter=function(){var t=null,r=this._view.items,n,i;if(this._filterText||this._cbSelectAll.indeterminate)for(t={},n=0;n<r.length;n++)i=r[n],i.show&&(t[i.text]=!0);this._filter.showValues=t;this._filter.filterText=this._filterText},t.prototype._filterTextChanged=function(){var n=this;this._toText&&clearTimeout(this._toText);this._toText=setTimeout(function(){var t=n._cmbFilter.text.toLowerCase();t!=n._filterText&&(n._filterText=t,n._view.refresh(),n._cbSelectAll.checked=!0,n._cbSelectAllClicked())},500)},t.prototype._filterValues=function(n){return this._filterText?n&&n.text?n.text.toLowerCase().indexOf(this._filterText)>-1:!1:!0},t.prototype._cbSelectAllClicked=function(){for(var i=this._cbSelectAll.checked,t=this._view.items,n=0;n<t.length;n++)t[n].show=i;this._view.refresh()},t.prototype._updateSelectAllCheck=function(){for(var n=0,t=this._view.items,i=0;i<t.length;i++)t[i].show&&n++;n==0?(this._cbSelectAll.checked=!1,this._cbSelectAll.indeterminate=!1):n==t.length?(this._cbSelectAll.checked=!0,this._cbSelectAll.indeterminate=!1):this._cbSelectAll.indeterminate=!0},t.controlTemplate='<div><div wj-part="div-filter"><\/div><div class="wj-listbox-item"><label><input wj-part="cb-select-all" type="checkbox"> <span wj-part="sp-select-all"><\/span><\/label><\/div><div wj-part="div-values" style="height:150px"><\/div><\/div>',t}(i.Control);n("ValueFilterEditor",a);s=function(){function n(n){this._c1=new h;this._c2=new h;this._and=!0;this._col=n;this._bnd=n.binding?new i.Binding(n.binding):null}return Object.defineProperty(n.prototype,"condition1",{get:function(){return this._c1},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"condition2",{get:function(){return this._c2},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"and",{get:function(){return this._and},set:function(n){this._and=i.asBoolean(n);this._bnd=this._col&&this._col.binding?new i.Binding(this._col.binding):null},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"dataMap",{get:function(){return this._map},set:function(n){this._map=i.asType(n,f.DataMap,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"column",{get:function(){return this._col},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isActive",{get:function(){return this._c1.isActive||this._c2.isActive},enumerable:!0,configurable:!0}),n.prototype.apply=function(n){var t=this._col,r=this._c1,u=this._c2,f,e;return!this._bnd||!this.isActive?!0:(n=this._bnd.getValue(n),t.dataMap?n=t.dataMap.getDisplayValue(n):i.isDate(n)?(i.isString(r.value)||i.isString(u.value))&&(n=i.Globalize.format(n,t.format)):i.isNumber(n)&&(n=i.Globalize.parseFloat(i.Globalize.format(n,t.format))),f=r.apply(n),e=u.apply(n),r.isActive&&u.isActive?this._and?f&&e:f||e:r.isActive?f:u.isActive?e:!0)},n.prototype.clear=function(){this._c1.clear();this._c2.clear();this.and=!0},n.prototype.implementsInterface=function(n){return n=='IColumnFilter'},n}();n("ConditionFilter",s);v=function(n){function t(t,r){var f,u;n.call(this,t);this._filter=i.asType(r,s,!1);f=this.getTemplate();this.applyTemplate('wj-control',f,{_divHdr:'div-hdr',_divCmb1:'div-cmb1',_divVal1:'div-val1',_btnAnd:'btn-and',_btnOr:'btn-or',_spAnd:'sp-and',_spOr:'sp-or',_divCmb2:'div-cmb2',_divVal2:'div-val2'});this._divHdr.textContent=i.culture.FlexGridFilter.header;this._spAnd.textContent=i.culture.FlexGridFilter.and;this._spOr.textContent=i.culture.FlexGridFilter.or;this._cmb1=this._createOperatorCombo(this._divCmb1);this._cmb2=this._createOperatorCombo(this._divCmb2);this._val1=this._createValueInput(this._divVal1);this._val2=this._createValueInput(this._divVal2);u=this._btnAndOrChanged.bind(this);this._btnAnd.addEventListener('change',u);this._btnOr.addEventListener('change',u);this.updateEditor()}return l(t,n),Object.defineProperty(t.prototype,"filter",{get:function(){return this._filter},enumerable:!0,configurable:!0}),t.prototype.updateEditor=function(){var n=this._filter.condition1,t=this._filter.condition2;this._cmb1.selectedValue=n.operator;this._cmb2.selectedValue=t.operator;this._val1 instanceof e.ComboBox?(this._val1.text=i.changeType(n.value,i.DataType.String,null),this._val2.text=i.changeType(t.value,i.DataType.String,null)):(this._val1.value=n.value,this._val2.value=t.value);this._btnAnd.checked=this._filter.and;this._btnOr.checked=!this._filter.and},t.prototype.clearEditor=function(){this._cmb1.selectedValue=this._cmb2.selectedValue=null;this._val1.text=this._val2.text=null;this._btnAnd.checked=!0;this._btnOr.checked=!1},t.prototype.updateFilter=function(){var n=this._filter.column,t=this._filter.condition1,r=this._filter.condition2,u;t.operator=this._cmb1.selectedValue;r.operator=this._cmb2.selectedValue;this._val1 instanceof e.ComboBox?(u=n.dataType==i.DataType.Date?i.DataType.String:n.dataType,t.value=i.changeType(this._val1.text,u,n.format),r.value=i.changeType(this._val2.text,u,n.format)):(t.value=this._val1.value,r.value=this._val2.value);this._filter.and=this._btnAnd.checked},t.prototype._createOperatorCombo=function(n){var t=this._filter.column,u=i.culture.FlexGridFilter.stringOperators,r;return t.dataType!=i.DataType.Date||this._isTimeFormat(t.format)?t.dataType!=i.DataType.Number||t.dataMap?t.dataType!=i.DataType.Boolean||t.dataMap||(u=i.culture.FlexGridFilter.booleanOperators):u=i.culture.FlexGridFilter.numberOperators:u=i.culture.FlexGridFilter.dateOperators,r=new e.ComboBox(n),r.itemsSource=u,r.displayMemberPath='name',r.selectedValuePath='op',r},t.prototype._createValueInput=function(n){var t=this._filter.column,r=null;return t.dataType!=i.DataType.Date||this._isTimeFormat(t.format)?t.dataType!=i.DataType.Number||t.dataMap?(r=new e.ComboBox(n),r.itemsSource=this._filter.dataMap?this._filter.dataMap.getDisplayValues():t.dataMap?t.dataMap.getDisplayValues():t.dataType==i.DataType.Boolean?[!0,!1]:null):(r=new e.InputNumber(n),r.format=t.format):(r=new e.InputDate(n),r.format=t.format),r.isRequired=!1,r},t.prototype._isTimeFormat=function(n){return n?(n=i.culture.Globalize.calendar.patterns[n]||n,/[Hmst]+/.test(n)):!1},t.prototype._btnAndOrChanged=function(n){this._btnAnd.checked=n.target==this._btnAnd;this._btnOr.checked=n.target==this._btnOr},t.controlTemplate='<div><div wj-part="div-hdr"><\/div><div wj-part="div-cmb1"><\/div><br/><div wj-part="div-val1"><\/div><br/><div style="text-align:center"><label><input wj-part="btn-and" type="radio"> <span wj-part="sp-and"><\/span> <\/label>&nbsp;&nbsp;&nbsp;<label><input wj-part="btn-or" type="radio"> <span wj-part="sp-or"><\/span> <\/label><\/div><div wj-part="div-cmb2"><\/div><br/><div wj-part="div-val2"><\/div><br/><\/div>',t}(i.Control);n("ConditionFilterEditor",v);h=function(){function n(){this._op=null}return Object.defineProperty(n.prototype,"operator",{get:function(){return this._op},set:function(n){this._op=i.asEnum(n,r,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"value",{get:function(){return this._val},set:function(n){this._val=n;this._strVal=i.isString(n)?n.toString().toLowerCase():null},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isActive",{get:function(){switch(this._op){case null:return!1;case r.EQ:case r.NE:return!0;default:return this._val!=null||this._strVal!=null}},enumerable:!0,configurable:!0}),n.prototype.clear=function(){this.operator=null;this.value=null},n.prototype.apply=function(n){var t=this._strVal||this._val;i.isString(n)&&(n=n.toLowerCase());switch(this._op){case null:return!0;case r.EQ:return i.isDate(n)&&i.isDate(t)?i.DateTime.sameDate(n,t):n==t;case r.NE:return n!=t;case r.GT:return n>t;case r.GE:return n>=t;case r.LT:return n<t;case r.LE:return n<=t;case r.BW:return this._strVal&&i.isString(n)?n.indexOf(this._strVal)==0:!1;case r.EW:return this._strVal&&i.isString(n)&&n.length>=this._strVal.length?n.substr(n.length-this._strVal.length)==t:!1;case r.CT:return this._strVal&&i.isString(n)?n.indexOf(this._strVal)>-1:!1;case r.NC:return this._strVal&&i.isString(n)?n.indexOf(this._strVal)<0:!1}throw'Unknown operator';},n}();n("FilterCondition",h),function(n){n[n.EQ=0]="EQ";n[n.NE=1]="NE";n[n.GT=2]="GT";n[n.GE=3]="GE";n[n.LT=4]="LT";n[n.LE=5]="LE";n[n.BW=6]="BW";n[n.EW=7]="EW";n[n.CT=8]="CT";n[n.NC=9]="NC"}(r||(r={}));n("Operator",r);c=function(){function n(n,t){this._owner=n;this._col=t;this._valueFilter=new o(t);this._conditionFilter=new s(t)}return Object.defineProperty(n.prototype,"filterType",{get:function(){return this._filterType!=null?this._filterType:this._owner.defaultFilterType},set:function(n){if(n!=this._filterType){var t=this.isActive;this.clear();this._filterType=i.asEnum(n,u,!0);t?this._owner.apply():this._col.grid&&this._col.grid.invalidate()}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"dataMap",{get:function(){return this.conditionFilter.dataMap||this.valueFilter.dataMap},set:function(n){this.conditionFilter.dataMap=n;this.valueFilter.dataMap=n},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"valueFilter",{get:function(){return this._valueFilter},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"conditionFilter",{get:function(){return this._conditionFilter},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"column",{get:function(){return this._col},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isActive",{get:function(){return this._conditionFilter.isActive||this._valueFilter.isActive},enumerable:!0,configurable:!0}),n.prototype.apply=function(n){return this._conditionFilter.apply(n)&&this._valueFilter.apply(n)},n.prototype.clear=function(){this._valueFilter.clear();this._conditionFilter.clear()},n.prototype.implementsInterface=function(n){return n=='IColumnFilter'},n}();n("ColumnFilter",c);i.culture.FlexGridFilter=window.wijmo.culture.FlexGridFilter||{ascending:'\u2191 Ascending',descending:'\u2193 Descending',apply:'Apply',clear:'Clear',conditions:'Filter by Condition',values:'Filter by Value',search:'Search',selectAll:'Select All',null:'(nothing)',header:'Show items where the value',and:'And',or:'Or',stringOperators:[{name:'(not set)',op:null},{name:'Equals',op:r.EQ},{name:'Does not equal',op:r.NE},{name:'Begins with',op:r.BW},{name:'Ends with',op:r.EW},{name:'Contains',op:r.CT},{name:'Does not contain',op:r.NC}],numberOperators:[{name:'(not set)',op:null},{name:'Equals',op:r.EQ},{name:'Does not equal',op:r.NE},{name:'Is Greater than',op:r.GT},{name:'Is Greater than or equal to',op:r.GE},{name:'Is Less than',op:r.LT},{name:'Is Less than or equal to',op:r.LE}],dateOperators:[{name:'(not set)',op:null},{name:'Equals',op:r.EQ},{name:'Is Before',op:r.LT},{name:'Is After',op:r.GT}],booleanOperators:[{name:'(not set)',op:null},{name:'Equals',op:r.EQ},{name:'Does not equal',op:r.NE}]};y=function(n){function t(t,r,f){var o=this,h,l,a,s,e;f===void 0&&(f=!0);n.call(this,t);this.filterChanged=new i.Event;this.buttonClicked=new i.Event;this._filter=i.asType(r,c);h=this.getTemplate();this.applyTemplate('wj-control wj-columnfiltereditor wj-content',h,{_divSort:'div-sort',_btnAsc:'btn-asc',_btnDsc:'btn-dsc',_divType:'div-type',_aVal:'a-val',_aCnd:'a-cnd',_divEdtVal:'div-edt-val',_divEdtCnd:'div-edt-cnd',_btnApply:'btn-apply',_btnClear:'btn-clear'});this._btnAsc.textContent=i.culture.FlexGridFilter.ascending;this._btnDsc.textContent=i.culture.FlexGridFilter.descending;this._aVal.textContent=i.culture.FlexGridFilter.values;this._aCnd.textContent=i.culture.FlexGridFilter.conditions;this._btnApply.textContent=i.culture.FlexGridFilter.apply;this._btnClear.textContent=i.culture.FlexGridFilter.clear;l=this.filter.conditionFilter.isActive||(r.filterType&u.Value)==0?u.Condition:u.Value;this._showFilter(l);a=this.filter.column;s=a.grid.collectionView;f&&s&&s.canSort||(this._divSort.style.display='none');e=this._btnClicked.bind(this);this._btnApply.addEventListener('click',e);this._btnClear.addEventListener('click',e);this._btnAsc.addEventListener('click',e);this._btnDsc.addEventListener('click',e);this._aVal.addEventListener('click',e);this._aCnd.addEventListener('click',e);this.hostElement.addEventListener('keydown',function(n){switch(n.keyCode){case i.Key.Enter:switch(n.target.tagName){case'A':case'BUTTON':o._btnClicked(n);break;default:o.updateFilter();o.onFilterChanged();o.onButtonClicked()}n.preventDefault();break;case i.Key.Escape:o.onButtonClicked();n.preventDefault()}})}return l(t,n),Object.defineProperty(t.prototype,"filter",{get:function(){return this._filter},enumerable:!0,configurable:!0}),t.prototype.updateEditor=function(){this._edtVal&&this._edtVal.updateEditor();this._edtCnd&&this._edtCnd.updateEditor()},t.prototype.updateFilter=function(){switch(this._getFilterType()){case u.Value:this._edtVal.updateFilter();this.filter.conditionFilter.clear();break;case u.Condition:this._edtCnd.updateFilter();this.filter.valueFilter.clear()}},t.prototype.onFilterChanged=function(n){this.filterChanged.raise(this,n)},t.prototype.onButtonClicked=function(n){this.buttonClicked.raise(this,n)},t.prototype._showFilter=function(n){n==u.Value&&this._edtVal==null&&(this._edtVal=new a(this._divEdtVal,this.filter.valueFilter));n==u.Condition&&this._edtCnd==null&&(this._edtCnd=new v(this._divEdtCnd,this.filter.conditionFilter));(n&this.filter.filterType)!=0&&(n==u.Value?(this._divEdtVal.style.display='',this._divEdtCnd.style.display='none',this._enableLink(this._aVal,!1),this._enableLink(this._aCnd,!0),this._edtVal.focus()):(this._divEdtVal.style.display='none',this._divEdtCnd.style.display='',this._enableLink(this._aVal,!0),this._enableLink(this._aCnd,!1),this._edtCnd.focus()));switch(this.filter.filterType){case u.None:case u.Condition:case u.Value:this._divType.style.display='none';break;default:this._divType.style.display=''}},t.prototype._enableLink=function(n,t){n.style.textDecoration=t?'':'none';n.style.fontWeight=t?'':'bold';t?n.href='':n.removeAttribute('href')},t.prototype._getFilterType=function(){return this._divEdtVal.style.display!='none'?u.Value:u.Condition},t.prototype._btnClicked=function(n){if(n.preventDefault(),n.stopPropagation(),!i.hasClass(n.target,'wj-state-disabled')){if(n.target==this._aVal){this._showFilter(u.Value);return}if(n.target==this._aCnd){this._showFilter(u.Condition);return}if(n.target==this._btnAsc||n.target==this._btnDsc){var t=this.filter.column,f=t.sortMemberPath?t.sortMemberPath:t.binding,r=t.grid.collectionView,e=new i.SortDescription(f,n.target==this._btnAsc);r.sortDescriptions.deferUpdate(function(){r.sortDescriptions.clear();r.sortDescriptions.push(e)})}n.target==this._btnApply?(this.updateFilter(),this.onFilterChanged()):n.target==this._btnClear?this.filter.isActive&&(this.filter.clear(),this.onFilterChanged()):this.updateEditor();this.onButtonClicked()}},t.controlTemplate='<div><div wj-part="div-sort"><a wj-part="btn-asc" href="" style="min-width:95px" draggable="false"><\/a>&nbsp;&nbsp;&nbsp;<a wj-part="btn-dsc" href="" style="min-width:95px" draggable="false"><\/a><\/div><div style="text-align:right;margin:10px 0px;font-size:80%"><div wj-part="div-type"><a wj-part="a-cnd" href="" draggable="false"><\/a>&nbsp;|&nbsp;<a wj-part="a-val" href="" draggable="false"><\/a><\/div><\/div><div wj-part="div-edt-val"><\/div><div wj-part="div-edt-cnd"><\/div><div style="text-align:right;margin-top:10px"><a wj-part="btn-apply" href="" draggable="false"><\/a>&nbsp;&nbsp;<a wj-part="btn-clear" href="" draggable="false"><\/a><\/div>',t}(i.Control);n("ColumnFilterEditor",y),function(n){n[n.None=0]="None";n[n.Condition=1]="Condition";n[n.Value=2]="Value";n[n.Both=3]="Both"}(u||(u={}));n("FilterType",u);w=function(){function n(n){this._showIcons=!0;this._showSort=!0;this._defFilterType=u.Both;this.filterApplied=new i.Event;this.filterChanging=new i.Event;this.filterChanged=new i.Event;var t='Missing dependency: FlexGridFilter requires ';i.assert(f!=null,t+'wijmo.grid.');i.assert(e!=null,t+'wijmo.input.');this._filters=[];this._g=i.asType(n,f.FlexGrid,!1);this._g.formatItem.addHandler(this._formatItem.bind(this));this._g.itemsSourceChanged.addHandler(this.clear.bind(this));this._g.hostElement.addEventListener('mousedown',this._mouseDown.bind(this),!0);this._g.invalidate()}return Object.defineProperty(n.prototype,"grid",{get:function(){return this._g},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"filterColumns",{get:function(){return this._filterColumns},set:function(n){this._filterColumns=i.asArray(n);this.clear()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"showFilterIcons",{get:function(){return this._showIcons},set:function(n){n!=this.showFilterIcons&&(this._showIcons=i.asBoolean(n),this._g&&this._g.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"showSortButtons",{get:function(){return this._showSort},set:function(n){this._showSort=i.asBoolean(n)},enumerable:!0,configurable:!0}),n.prototype.getColumnFilter=function(n,t){var r,u;for(t===void 0&&(t=!0),i.isString(n)?n=this._g.getColumn(n):i.isNumber(n)&&(n=this._g.columns[n]),n=i.asType(n,f.Column),r=0;r<this._filters.length;r++)if(this._filters[r].column==n)return this._filters[r];return t&&n.binding?(u=new c(this,n),this._filters.push(u),u):null},Object.defineProperty(n.prototype,"defaultFilterType",{get:function(){return this._defFilterType},set:function(n){n!=this.defaultFilterType&&(this._defFilterType=i.asEnum(n,u,!1),this._g.invalidate(),this.clear())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"filterDefinition",{get:function(){for(var n,t,u,i={defaultFilterType:this.defaultFilterType,filters:[]},r=0;r<this._filters.length;r++)n=this._filters[r],n&&n.column&&n.column.binding&&(n.conditionFilter.isActive?(t=n.conditionFilter,i.filters.push({binding:n.column.binding,type:'condition',condition1:{operator:t.condition1.operator,value:t.condition1.value},and:t.and,condition2:{operator:t.condition2.operator,value:t.condition2.value}})):n.valueFilter.isActive&&(u=n.valueFilter,i.filters.push({binding:n.column.binding,type:'value',filterText:u.filterText,showValues:u.showValues})));return JSON.stringify(i)},set:function(n){var e=JSON.parse(i.asString(n)),f,r,s;for(this.clear(),this.defaultFilterType=e.defaultFilterType,f=0;f<e.filters.length;f++){var t=e.filters[f],u=this._g.getColumn(t.binding),o=this.getColumnFilter(u,!0);if(o)switch(t.type){case'condition':r=o.conditionFilter;r.condition1.value=u.dataType==i.DataType.Date?i.changeType(t.condition1.value,u.dataType,null):t.condition1.value;r.condition1.operator=t.condition1.operator;r.and=t.and;r.condition2.value=u.dataType==i.DataType.Date?i.changeType(t.condition2.value,u.dataType,null):t.condition2.value;r.condition2.operator=t.condition2.operator;break;case'value':s=o.valueFilter;s.filterText=t.filterText;s.showValues=t.showValues}}this.apply()},enumerable:!0,configurable:!0}),n.prototype.editColumnFilter=function(n,t){var e=this,r;this.closeEditor();n=i.isString(n)?this._g.getColumn(n):i.asType(n,f.Column,!1);r=new f.CellRangeEventArgs(this._g.cells,new f.CellRange(-1,n.index));this.onFilterChanging(r);if(!r.cancel){r.cancel=!0;var u=document.createElement('div'),l=this.getColumnFilter(n),s=new y(u,l,this.showSortButtons);i.addClass(u,'wj-dropdown-panel');this._g.rightToLeft&&(u.dir='rtl');s.filterChanged.addHandler(function(){r.cancel=!1;setTimeout(function(){r.cancel||e.apply()})});s.buttonClicked.addHandler(function(){e.closeEditor();e.onFilterChanged(r)});s.lostFocus.addHandler(function(){setTimeout(function(){var n=i.Control.getControl(e._divEdt);n&&!n.containsFocus()&&e.closeEditor()},10)});var c=this._g.columnHeaders,a=t?t.row:c.rows.length-1,v=t?t.col:n.index,o=c.getCellBoundingRect(a,v),h=document.elementFromPoint(o.left+o.width/2,o.top+o.height/2);h=i.closest(h,'.wj-cell');h?i.showPopup(u,h,!1,!1,!1):i.showPopup(u,o);s.focus();this._divEdt=u;this._edtCol=n}},n.prototype.closeEditor=function(){if(this._divEdt){i.hidePopup(this._divEdt,!0);var n=i.Control.getControl(this._divEdt);n&&n.dispose();this._divEdt=null;this._edtCol=null}},n.prototype.apply=function(){var n=this._g.collectionView,t;n&&(n.filter?n.refresh():n.filter=this._filter.bind(this));t=n?n.updateFilterDefinition:null;i.isFunction(t)&&t.call(n,this);this.onFilterApplied()},n.prototype.clear=function(){this._filters.length&&(this._filters=[],this.apply())},n.prototype.onFilterApplied=function(n){this.filterApplied.raise(this,n)},n.prototype.onFilterChanging=function(n){this.filterChanging.raise(this,n)},n.prototype.onFilterChanged=function(n){this.filterChanged.raise(this,n)},n.prototype._filter=function(n){for(var t=0;t<this._filters.length;t++)if(!this._filters[t].apply(n))return!1;return!0},n.prototype._formatItem=function(t,r){var e,o,a;if(r.panel.cellType==f.CellType.ColumnHeader){var s=this._g,c=s.getMergedRange(r.panel,r.row,r.col)||new f.CellRange(r.row,r.col),l=s.columns[c.col],h=s._getBindingColumn(r.panel,r.row,l);(c.row2==r.panel.rows.length-1||l!=h)&&(e=this.getColumnFilter(h,this.defaultFilterType!=u.None),this._filterColumns&&this._filterColumns.indexOf(h.binding)<0&&(e=null),e&&e.filterType!=u.None?(this._showIcons&&(n._filterGlyph||(n._filterGlyph=i.createElement('<div class="'+n._WJC_FILTER+'"><span class="wj-glyph-filter"></span></div>')),o=r.cell.querySelector('div')||r.cell,a=o.querySelector('.wj-glyph-filter'),a||o.insertBefore(n._filterGlyph.cloneNode(!0),o.firstChild)),i.toggleClass(r.cell,'wj-filter-on',e.isActive),i.toggleClass(r.cell,'wj-filter-off',!e.isActive)):(i.removeClass(r.cell,'wj-filter-on'),i.removeClass(r.cell,'wj-filter-off')))}},n.prototype._mouseDown=function(t){var o=this,u,r,e,f;t.defaultPrevented||t.button!=0||i.closest(t.target,'.'+n._WJC_FILTER)&&(u=this._g,r=u.hitTest(t),r.panel==u.columnHeaders&&(e=u.columns[r.col],f=u._getBindingColumn(r.panel,r.row,e),this._divEdt&&this._edtCol==f?this.closeEditor():setTimeout(function(){o.editColumnFilter(f,r)},this._divEdt?100:0),t.stopPropagation(),t.preventDefault()))},n._WJC_FILTER='wj-elem-filter',n}();n("FlexGridFilter",w)}}})